apiVersion: apps/v1
kind: Deployment
metadata:
  name: next-visit-fan-out
  namespace: next-visit-fan-out
  labels:
    app: next-visit-fan-out
spec:
  replicas: 1
  selector:
    matchLabels:
      app: next-visit-fan-out
  template:
    metadata:
      labels:
        app: next-visit-fan-out
      annotations:
        prometheus.io/scrape: 'true'
        prometheus.io/port: '8000'
    spec:
      containers:
        - name: next-visit-fan-out
          image: ghcr.io/lsst-dm/next_visit_fan_out:v1.0.1
          imagePullPolicy: Always
          env:
            - name: LATISS_KNATIVE_SERVING_URL
              value: http://prompt-proto-service.prompt-proto-service/next-visit
            - name: HSC_KNATIVE_SERVING_URL
              value: http://prompt-proto-service.prompt-proto-service/next-visit
            - name: LSST_CAM_KNATIVE_SERVING_URL
              value: http://lsst-cam-prompt-proto-service.lsst-cam-prompt-proto-service/next-visit
            - name: DETECTOR_CONFIG_FILE
              value: detector.yaml
            - name: KAFKA_CLUSTER
              value: 10.96.224.141:9094
            - name: CONSUMER_GROUP
              value: test-group-3
            - name: NEXT_VISIT_TOPIC
              value: test.next-visit
            - name: SASL_MECHANISM
              value: SCRAM-SHA-512
            - name: SECURITY_PROTOCOL
              value: SASL_PLAINTEXT
            - name: SASL_USERNAME
              valueFrom:
                secretKeyRef:
                  key: kafka_pp_sasl_username
                  name: kafka-sasl-prompt-prompt-processing
            - name: SASL_PASSWORD
              valueFrom:
                secretKeyRef:
                  key: kafka_pp_sasl_password
                  name: kafka-sasl-prompt-prompt-processing
            - name: KAFKA_SCHEMA_REGISTRY_URL
              value: http://10.99.65.182:8081
            - name: OFFSET
              value: latest
      volumes:
        - name: kafka-sasl-prompt-prompt-processing
          secret:
            secretName: kafka-sasl-prompt-prompt-processing
          